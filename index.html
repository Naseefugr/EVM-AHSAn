<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHSAN 2026-27 Committee Election</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --primary: #1a237e; /* Deep Blue */
            --secondary: #c62828; /* Red for accents */
            --accent: #ffd700; /* Gold */
            --bg: #f0f2f5;
            --text: #333;
            --card-bg: #ffffff;
            --shadow: 0 10px 20px rgba(0,0,0,0.15);
            --font-main: 'Poppins', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .flex-center { display: flex; justify-content: center; align-items: center; }
        .full-screen { width: 100%; height: 100%; position: absolute; top: 0; left: 0; background: var(--bg); z-index: 10; }
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.3); }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background: linear-gradient(135deg, var(--primary), #283593); color: white; }
        .btn-danger { background: linear-gradient(135deg, #c62828, #e53935); color: white; }
        
        /* --- TOAST NOTIFICATIONS --- */
        #toast-container {
            position: fixed; top: 20px; right: 20px; z-index: 2000;
        }
        .toast {
            background: white; color: #333; padding: 16px 24px;
            border-radius: 8px; margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex; align-items: center;
            border-left: 5px solid var(--primary);
            font-weight: 600;
        }
        @keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- 1. INTRO PAGE --- */
        #intro-page {
            background: radial-gradient(circle at top right, var(--primary), #0d47a1);
            color: white;
            flex-direction: column;
            text-align: center;
        }
        .logo-area {
            margin-bottom: 40px;
            animation: float 4s ease-in-out infinite;
        }
        .logo-icon { font-size: 90px; margin-bottom: 15px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
        .election-title { font-size: 3rem; font-weight: 800; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .election-subtitle { font-size: 1.4rem; opacity: 0.9; margin-bottom: 50px; }

        /* Home Stats Bar */
        .home-stats-container {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }
        .home-stat-box {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.4);
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            min-width: 140px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .home-stat-num { display: block; font-size: 2.2rem; font-weight: 800; color: var(--accent); }
        .home-stat-label { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.8; }

        /* --- 2. LOGIN PAGE --- */
        #login-page { flex-direction: column; background: #fff; }
        .login-card {
            background: var(--card-bg); padding: 50px 40px; border-radius: 20px;
            box-shadow: var(--shadow); width: 90%; max-width: 420px; text-align: center;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .login-card h2 { color: var(--primary); margin-bottom: 30px; font-weight: 700; }
        .input-group { margin-bottom: 25px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; font-size: 0.9rem; }
        .input-group input {
            width: 100%; padding: 14px 16px; border: 2px solid #e0e0e0; border-radius: 10px;
            font-size: 1rem; outline: none; transition: all 0.3s; background: #f9f9f9;
        }
        .input-group input:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px rgba(26,35,126,0.1); }
        .admin-link { margin-top: 20px; font-size: 0.9rem; color: #888; cursor: pointer; text-decoration: none; font-weight: 500; transition: color 0.2s; }
        .admin-link:hover { color: var(--primary); text-decoration: underline; }
        .password-hint { font-size: 0.8rem; color: #888; margin-bottom: 15px; font-style: italic; }

        /* --- 2b. ADMIN AUTH PAGE --- */
        #admin-auth-page { flex-direction: column; background: #263238; }
        .auth-card { background: white; padding: 40px; border-radius: 15px; width: 320px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }

        /* --- 3. INKING ANIMATION (Custom Designed) --- */
        #inking-page { background: #263238; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        
        .animation-container {
            width: 300px; height: 500px; position: relative;
        }

        /* The SVG ViewBox is roughly 200x400 */
        #finger-svg {
            width: 100%; height: 100%;
            /* Drop shadow for depth */
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
        }

        /* Skin Color */
        .finger-skin { fill: #ffccbc; }
        .finger-shadow { fill: #e6b9a8; }

        /* The INK LINE (Straight Vertical) */
        .ink-line {
            fill: none; 
            stroke: #000000; 
            stroke-width: 6; 
            stroke-linecap: round;
            stroke-dasharray: 150; 
            stroke-dashoffset: 150; /* Hidden initially */
            /* Positioning: x=140 corresponds to outer side */
        }

        /* The Brush/Marker Hand */
        .brush-svg {
            width: 100px; height: 100px;
            position: absolute; top: 0; left: -150px; z-index: 20;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
        }

        .inking-text { 
            color: white; margin-top: 30px; font-size: 1.5rem; font-weight: 700; letter-spacing: 1px;
            opacity: 0; animation: fadeInText 1s forwards 1s;
        }
        @keyframes fadeInText { to { opacity: 1; } }

        /* --- 4. VOTING PAGES --- */
        #voting-page { padding: 30px; overflow-y: auto; background: var(--bg); }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 2px solid #e0e0e0; margin-bottom: 30px; }
        .user-info { font-weight: 700; color: var(--primary); font-size: 1.1rem; }
        .position-title { text-align: center; font-size: 2.2rem; color: var(--primary); margin-bottom: 40px; font-weight: 800; letter-spacing: -0.5px; }
        
        .nominees-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; max-width: 1100px; margin: 0 auto; padding-bottom: 50px;
        }
        .nominee-card {
            background: white; border-radius: 16px; overflow: hidden; box-shadow: var(--shadow);
            transition: all 0.3s ease; cursor: pointer; border: none; position: relative;
        }
        .nominee-card:hover { transform: translateY(-8px); box-shadow: 0 20px 30px rgba(0,0,0,0.15); }
        .nominee-img { width: 100%; height: 260px; object-fit: cover; background: #eee; border-bottom: 1px solid #f0f0f0; }
        .nominee-info { padding: 20px; text-align: center; }
        .nominee-name { font-size: 1.3rem; font-weight: 700; color: #222; margin-bottom: 5px; }
        .nominee-role { font-size: 0.85rem; color: #777; text-transform: uppercase; letter-spacing: 1.2px; font-weight: 600; }
        
        .vote-btn-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(26, 35, 126, 0.95); color: white;
            display: flex; justify-content: center; align-items: center; font-size: 1.8rem; font-weight: 800;
            opacity: 0; transition: opacity 0.2s; backdrop-filter: blur(2px);
        }
        .nominee-card:hover .vote-btn-overlay { opacity: 1; }

        /* --- NOTA Card Style --- */
        .nota-card {
            grid-column: 1 / -1; 
            height: 160px; 
            background-color: #ffebee;
            border: 2px dashed #ef9a9a;
            flex-direction: row; 
            gap: 30px;
            padding: 0 50px;
            align-items: center; 
            justify-content: center;
        }
        .nota-card .nominee-name { color: #c62828; font-size: 2.5rem; margin: 0; line-height: 1.1; }
        .nota-card .nominee-role { font-size: 1.1rem; color: #777; text-transform: none; letter-spacing: 0.5px; }
        .nota-icon { font-size: 3.5rem; color: #c62828; margin: 0; }
        .nota-card:hover { border-color: #c62828; background-color: #ffcdd2; }

        /* --- 5. SUCCESS / PAPER DROP (Improved) --- */
        #success-page { background: #e3f2fd; position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .table-surface {
            width: 100%; height: 180px; background: #a1887f;
            position: absolute; bottom: 0; left: 0;
            border-top: 10px solid #795548;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .ballot-box {
            width: 200px; height: 240px;
            position: absolute; bottom: 180px; left: 50%; transform: translateX(-50%); z-index: 2;
            animation: boxEnter 0.8s ease-out forwards;
        }
        @keyframes boxEnter { from { transform: translate(-50%, 50px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

        .box-body {
            width: 100%; height: 200px; background: #37474f;
            border: 4px solid #263238; border-radius: 8px;
            position: absolute; bottom: 0;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.6);
            overflow: hidden;
        }
        /* Box shine effect */
        .box-body::after {
            content: ''; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 1px solid rgba(255,255,255,0.1); border-radius: 4px;
        }

        .box-lid {
            width: 110%; height: 50px; background: #455a64;
            border: 4px solid #263238; border-bottom: none;
            border-radius: 8px 8px 0 0;
            position: absolute; top: -35px; left: -5%;
            transform: perspective(600px) rotateX(-15deg);
            transform-origin: bottom;
            transition: transform 0.5s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        /* Lid pop animation */
        .ballot-box.lid-open .box-lid {
            transform: perspective(600px) rotateX(25deg);
            background: #546e7a;
        }

        .box-slot {
            width: 70%; height: 6px; background: #000;
            position: absolute; top: 5px; left: 15%;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.8);
        }

        .paper {
            width: 110px; height: 150px; background: white; border: 1px solid #ddd;
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.8); z-index: 3; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--secondary);
            font-size: 1.2rem;
            opacity: 0;
        }

        @keyframes foldAndDrop {
            0% { transform: translate(-50%, -50%) scale(0.8) rotate(0deg) scaleX(1); opacity: 0; }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(0.8) rotate(0deg) scaleX(1); }
            40% { transform: translate(-50%, -50%) scale(0.8) rotate(0deg) scaleX(0.1); } /* Fold */
            50% { transform: translate(-50%, -100%) scale(0.8) rotate(5deg); } /* Arc Up */
            80% { transform: translate(-50%, 50%) scale(0.8) rotate(-5deg); opacity: 1; } /* Arc Down */
            100% { transform: translate(-50%, 200px) scale(0.8) rotate(0deg); opacity: 0; } /* In box */
        }

        .thanks-msg {
            position: absolute; top: 25%; width: 100%; text-align: center;
            font-size: 3.5rem; color: var(--primary); font-weight: 900; opacity: 0;
            animation: fadeInThanks 0.8s 2.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            z-index: 10; text-shadow: 0 2px 0 rgba(255,255,255,0.5);
        }
        @keyframes fadeInThanks { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- 6. ADMIN DASHBOARD --- */
        #admin-page { padding: 30px; background: #f4f6f8; overflow-y: auto; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .dashboard-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 40px;
        }
        .stat-card {
            background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center;
            border-top: 4px solid var(--primary);
        }
        .stat-number { font-size: 2.8rem; font-weight: 800; color: var(--primary); margin: 10px 0; }
        .stat-label { color: #666; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }

        .voters-list-container {
            background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            max-height: 400px; overflow-y: auto; border: 1px solid #eee;
        }
        .voter-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f5f5f5; font-size: 0.9rem; align-items: center; }
        .voter-row:last-child { border-bottom: none; }
        
        .list-header { margin-top: 40px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .list-header h3 { font-size: 1.2rem; color: #333; }

        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        .status-voted { background-color: #e8f5e9; color: #2e7d32; }
        .status-pending { background-color: #ffebee; color: #c62828; }

        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 40px;}
        .nom-stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .nom-stat-card h3 { border-bottom: 2px solid var(--accent); padding-bottom: 15px; margin-bottom: 20px; color: var(--primary); }
        .stat-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f9f9f9; font-weight: 600; font-size: 0.95rem; }
        .stat-bar-bg { width: 100%; height: 8px; background: #f0f0f0; border-radius: 4px; margin-top: 8px; overflow: hidden; }
        .stat-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 1s ease-out; }
        
        .reset-section { text-align: right; padding: 25px; background: #ffebee; border-radius: 12px; border: 1px solid #ffcdd2; }
        
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary);
            border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 10px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* IMPROVED INK ANIMATION KEYFRAMES */
        .animate-brush-in {
            animation: brushEnter 0.8s forwards cubic-bezier(0.25, 1, 0.5, 1);
        }
        .animate-ink-stroke {
            animation: drawStroke 1s forwards ease-in-out 0.8s;
        }
        .animate-brush-out {
            animation: brushExit 0.8s forwards cubic-bezier(0.25, 1, 0.5, 1) 1.8s;
        }

        /* Brush moves to the line position (approx x=140 on SVG 200 width -> 70% in container) */
        @keyframes brushEnter {
            0% { left: -150px; top: 100px; transform: rotate(-30deg); }
            100% { left: 200px; top: 120px; transform: rotate(-15deg); }
        }
        @keyframes drawStroke {
            0% { stroke-dashoffset: 150; }
            100% { stroke-dashoffset: 0; }
        }
        @keyframes brushExit {
            0% { left: 200px; top: 250px; transform: rotate(-15deg); }
            100% { left: 400px; top: 250px; transform: rotate(-15deg); }
        }

    </style>
</head>
<body>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- 1. INTRO PAGE -->
    <section id="intro-page" class="full-screen flex-center">
        <div class="logo-area">
            <div class="logo-icon">üó≥Ô∏è</div>
            <h1 class="election-title">AHSAN</h1>
            <p class="election-subtitle">2026 - 27 Committee Election</p>
        </div>

        <div class="home-stats-container">
            <div class="home-stat-box">
                <span class="home-stat-num" id="home-total">0</span>
                <span class="home-stat-label">Total Students</span>
            </div>
            <div class="home-stat-box">
                <span class="home-stat-num" id="home-voted">0</span>
                <span class="home-stat-label">Votes Cast</span>
            </div>
            <div class="home-stat-box">
                <span class="home-stat-num" id="home-waiting">0</span>
                <span class="home-stat-label">Not Voted</span>
            </div>
        </div>

        <button class="btn" style="background: var(--accent); color: var(--primary);" onclick="app.goToLogin()">Start Voting</button>
    </section>

    <!-- 2. VOTER LOGIN PAGE -->
    <section id="login-page" class="full-screen flex-center hidden">
        <div class="login-card">
            <h2>Voter Login</h2>
            <div class="input-group">
                <label for="voterId">Voter ID</label>
                <input type="text" id="voterId" placeholder="e.g., 1050" autocomplete="off">
            </div>
            <div class="input-group">
                <label for="voterPass">Password</label>
                <input type="password" id="voterPass" placeholder="First 4 letters of Name + DOB">
                <div class="password-hint">Format: First 4 letters of Name + DDMMYYYY</div>
            </div>
            <button class="btn btn-primary" style="width: 100%" onclick="app.verifyVoter()">Verify & Vote</button>
            <div class="spinner hidden" id="login-spinner"></div>
            <p class="admin-link" onclick="app.goToAdminAuth()">Admin Panel</p>
        </div>
    </section>

    <!-- 2b. ADMIN AUTH PAGE -->
    <section id="admin-auth-page" class="full-screen flex-center hidden">
        <div class="auth-card">
            <h2 style="color: var(--primary); margin-bottom: 20px;">Admin Login</h2>
            <div class="input-group">
                <label>Username</label>
                <input type="text" id="adminUser" placeholder="Enter username">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="adminPass" placeholder="Enter password">
            </div>
            <button class="btn btn-primary" style="width: 100%" onclick="app.verifyAdmin()">Login</button>
            <button class="btn" style="width: 100%; margin-top: 15px; background: #ddd; color: #333;" onclick="app.goToIntro()">Back</button>
        </div>
    </section>

    <!-- 3. INKING ANIMATION (Improved SVG & Animation) -->
    <section id="inking-page" class="full-screen hidden">
        <div class="animation-container">
            
            <!-- Custom Finger SVG: Left hand index finger (Side Profile) -->
            <svg id="finger-svg" viewBox="0 0 200 400" preserveAspectRatio="xMidYMid meet">
                <!-- Finger Base/Shading -->
                <path d="M60,40 Q60,200 70,220 L130,220 Q140,200 140,40 L120,20 L80,20 Z" fill="#d7ccc8" />
                
                <!-- Main Finger Body (Left Index) -->
                <path d="M70,20 L130,20 L135,35 Q145,35 145,55 L145,175 Q145,190 135,195 L65,195 Q55,190 55,175 L55,55 Q55,35 65,35 Z" fill="#ffccbc" />
                
                <!-- Nail -->
                <path d="M65,20 L135,20 Q130,38 135,38 L65,38 Q60,20 65,20" fill="#f8d9ce" stroke="#eebfae" stroke-width="1" />
                <path d="M70,20 L130,20 Q128,35 130,35 L70,35 Q68,20 70,20" fill="#ffffff" opacity="0.3" />

                <!-- Knuckle Wrinkle Lines -->
                <path d="M60,180 L140,180" stroke="#e6b9a8" stroke-width="2" stroke-linecap="round" opacity="0.6" />
                <path d="M65,190 L135,190" stroke="#e6b9a8" stroke-width="2" stroke-linecap="round" opacity="0.6" />

                <!-- THE INK LINE: Outer side, Vertical, Cuticle to Knuckle -->
                <!-- x=135 is the outer edge. y=38 is just below nail. y=180 is just above knuckle -->
                <line x1="135" y1="38" x2="135" y2="180" class="ink-line" id="ink-path" stroke-linecap="butt" />
            </svg>

            <!-- The Brush Hand -->
            <svg class="brush-svg" id="brush-anim" viewBox="0 0 100 100">
                <!-- Hand holding marker -->
                <path d="M10,40 L30,40 L35,90 L5,90 Z" fill="#f5f5f5" stroke="#ccc" stroke-width="1" />
                <!-- Marker Body -->
                <rect x="28" y="10" width="6" height="40" fill="#333" rx="2" />
                <!-- Marker Tip (Wet ink) -->
                <rect x="27" y="5" width="8" height="8" fill="#000000" rx="1" />
            </svg>
        </div>
        <p class="inking-text">Marking Voter...</p>
    </section>

    <!-- 4. VOTING PAGE -->
    <section id="voting-page" class="full-screen hidden">
        <div class="header">
            <div class="user-info">Voter: <span id="display-voter-name">Guest</span> (<span id="display-voter-id">--</span>)</div>
            <div style="font-size: 0.9rem; color: #777; font-weight:600;">AHSAN Election 2026</div>
        </div>

        <h2 class="position-title" id="position-title">President</h2>

        <div class="nominees-grid" id="nominees-container">
            <!-- Cards injected by JS -->
        </div>
    </section>

    <!-- 5. SUCCESS / THANKS PAGE -->
    <section id="success-page" class="full-screen hidden">
        <h1 class="thanks-msg">THANK YOU!</h1>
        <div class="paper">VOTE</div>
        <div class="ballot-box" id="ballot-box-anim">
            <div class="box-lid">
                <div class="box-slot"></div>
            </div>
            <div class="box-body"></div>
        </div>
        <div class="table-surface"></div>
    </section>

    <!-- 6. ADMIN PAGE -->
    <section id="admin-page" class="full-screen hidden">
        <div class="admin-header">
            <h2>Admin Dashboard</h2>
            <button class="btn btn-primary" onclick="app.goToIntro()">Logout</button>
        </div>

        <!-- Stats Overview -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-label">Total Students</div>
                <div class="stat-number" id="stat-total">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Voted</div>
                <div class="stat-number" id="stat-voted" style="color: var(--secondary);">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Waiting (Not Voted)</div>
                <div class="stat-number" id="stat-waiting" style="color: #43a047;">0</div>
            </div>
        </div>

        <!-- Nominee Results -->
        <h3>Live Results</h3>
        <div class="stats-container" id="admin-stats">
            <!-- Stats injected by JS -->
        </div>

        <!-- SEPARATE VOTED LIST -->
        <div class="list-header">
            <h3 style="color: var(--primary);">Voted Students</h3>
            <span class="status-badge status-voted" id="count-voted-badge">0</span>
        </div>
        <div class="voters-list-container" id="voted-list">
            <!-- Voted list injected by JS -->
        </div>

        <!-- SEPARATE PENDING LIST -->
        <div class="list-header">
            <h3 style="color: #c62828;">Pending (Not Voted) Students</h3>
            <span class="status-badge status-pending" id="count-pending-badge">0</span>
        </div>
        <div class="voters-list-container" id="pending-list">
            <!-- Pending list injected by JS -->
        </div>

        <div class="reset-section">
            <h3 style="color: var(--secondary); margin-bottom: 10px;">Danger Zone</h3>
            <p style="margin-bottom: 15px; font-size: 0.9rem;">This will reset ALL vote counts and allow all voters to vote again.</p>
            <button class="btn btn-danger" onclick="app.resetElection()">Reset All Data</button>
        </div>
    </section>

    <!-- JAVASCRIPT LOGIC -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDEfQv3XYO2_81RutRrI0HN959dXyTIXQ0",
            authDomain: "evm-ahsan.firebaseapp.com",
            databaseURL: "https://evm-ahsan-default-rtdb.firebaseio.com",
            projectId: "evm-ahsan",
            storageBucket: "evm-ahsan.firebasestorage.app",
            messagingSenderId: "300478736352",
            appId: "1:300478736352:web:c76a7ed0e65f7548372d85",
            measurementId: "G-VDWJL8CL7S"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

    // --- 2. DATA CONFIGURATION ---
        const POSITIONS = ['president', 'secretary', 'treasurer'];
        const NOMINEES = {
            president: [
                { id: 'p1', name: 'Sayyid Saloom KK', photo: './img/salu.jpg' },
                { id: 'p2', name: 'Ahammed Sadeed T', photo: './img/sidu.jpg' },
                { id: 'p3', name: 'Muddassir Sinan MK', photo: './img/mudu.jpeg' }
            ],
            secretary: [
                { id: 's1', name: 'Muhammed Salim MK', photo: './img/salimu.jpg' },
                { id: 's2', name: 'Muhammed Rishab KM', photo: './img/rishu.jpg' },
                { id: 's3', name: 'Muhammed Thanseeh PK', photo: './img/tanu.jpg' }
            ],
            treasurer: [
                { id: 't1', name: 'Muhammed Sabith MT', photo: './img/sabi.jpg' },
                { id: 't2', name: 'Muhammed Jasir AV', photo: './img/jasu.jpg' },
                { id: 't3', name: 'Muhammed Sabith M', photo: './img/sabi1.jpg' }
            ]
        };
const VOTERS = {
  "1050": { name: "MUHAMMAD SINAN PC", dob: "25-07-2010" },
  "1070": { name: "MUHAMMED MUSAMMIL B K", dob: "03-09-2009" },
  "1074": { name: "MUAD .M.", dob: "03-06-2010" },
  "1058": { name: "MUHAMMED JALAL AT", dob: "04-08-2009" },
  "1051": { name: "MUHAMMAD HISHAM T", dob: "23-07-2009" },
  "1056": { name: "MUHAMMED SHADIN N.M.", dob: "14-07-2010" },
  "1076": { name: "MUHAMMED MINHAJ KK", dob: "03-05-2010" },
  "1071": { name: "SAYYID MOHAMMAD ZUHAIR A K", dob: "11-02-2011" },
  "1075": { name: "MUHAMMED HASHIM P", dob: "19-02-2011" },
  "1061": { name: "ANSHID M P", dob: "27-05-2010" },
  "1072": { name: "MOHAMMED SINAN TP", dob: "25-07-2010" },
  "1078": { name: "MUHAMMED RABIEUE MK", dob: "22-11-2010" },
  "1088": { name: "MOHAMMED NAEEM K", dob: "21-12-2010" },
  "1082": { name: "MUHAMMED SANEEN", dob: "08-07-2010" },
  "1090": { name: "MUHAMMED BASSAM", dob: "30-08-2010" },
  "1066": { name: "HASHIM MOHAMMED K P", dob: "19-09-2009" },
  "1063": { name: "MOHAMMED RISHADH. T", dob: "11-09-2009" },
  "1073": { name: "MUHAMMAD MUSTHAFA KK", dob: "07-08-2009" },
  "1068": { name: "MUHAMMED UVAIS.EK", dob: "11-09-2010" },
  "1053": { name: "AMEEN T", dob: "31-05-2010" },
  "1040": { name: "MUHAMMAD RIFAD K", dob: "08-10-2009" },
  "1059": { name: "AFSAL", dob: "11-02-2010" },
  "1064": { name: "MOHAMED SHAMIL M", dob: "19-10-2010" },
  "1013": { name: "MOHAMMED SAHAD.K", dob: "23-02-2010" },
  "1087": { name: "MUHAMMED SHAMIL. A", dob: "14-10-2010" },
  "1089": { name: "ADIL SHAH M", dob: "13-10-2010" },
  "1084": { name: "ASIM MOHAMED M", dob: "19-03-2011" },
  "1024": { name: "FADHIL KATTIPARUTHI", dob: "23-08-2009" },
  "1008": { name: "MUHAMMED MINHAJ", dob: "17-08-2009" },
  "1086": { name: "MOHAMMED NIDAL", dob: "28-07-2010" },
  "1085": { name: "MUHAMMED NAFIH", dob: "18-04-2011" },
  "1014": { name: "MURSHID MK", dob: "03-04-2010" },
  "1022": { name: "MUHAMMAD NASEEF K", dob: "11-02-2009" },
  "970": { name: "ABDUL BASIT PARAMBADEN", dob: "16-06-2007" },
  "1035": { name: "MUHAMMED SABEEH MK", dob: "05-01-2010" },
  "1012": { name: "MOHAMMED RUBAIB O P", dob: "27-05-2009" },
  "1038": { name: "MUHAMMAD SALIM KP", dob: "16-06-2009" },
  "1168": { name: "MOHAMMED HITHBAN P", dob: "14-03-2010" },
  "1211": { name: "MUHAMMAD MUNAVVAR", dob: "08-07-2008" },
  "1010": { name: "SHABEER ALI P.V", dob: "11-08-2009" },
  "1037": { name: "MUHAMMAD SHIFIN", dob: "10-10-2009" },
  "1023": { name: "ABDUL BASITH KK", dob: "30-06-2009" },
  "1025": { name: "MUHAMMED ASLAH", dob: "20-08-2009" },
  "1005": { name: "MUHAMMAD SINAN.MK", dob: "15-07-2008" },
  "1031": { name: "MUHAMMED SAHAL N", dob: "16-06-2008" },
  "1041": { name: "MUHAMMED SHAMMAS. M", dob: "18-07-2009" },
  "1033": { name: "MUHAMMED SHAJEEH", dob: "08-08-2008" },
  "1016": { name: "ABDUL NAFIH", dob: "28-03-2010" },
  "998": { name: "MUHAMMED RINSHAD P", dob: "14-05-2009" },
  "1030": { name: "NIHAL ABOOBACKER", dob: "28-04-2009" },
  "1028": { name: "SHINAS MOHAMED", dob: "05-04-2010" },
  "1019": { name: "MOHAMMED IHSAN C", dob: "18-08-2009" },
  "1036": { name: "SABEEH AHMED. N. K.", dob: "24-10-2009" },
  "975": { name: "MUHAMMED SANIH", dob: "23-05-2009" },
  "1026": { name: "MUHAMMED RABEEH. T", dob: "21-03-2010" },
  "1021": { name: "AHMED JURAIJ KT", dob: "12-11-2009" },
  "1018": { name: "MUHAMMED AJUMAL", dob: "08-07-2008" },
  "1006": { name: "AFLAH AHAMED C", dob: "07-11-2008" },
  "1004": { name: "MUHAMMED VASIL C.S", dob: "10-07-2008" },
  "1039": { name: "SALMAN NASOOH", dob: "29-10-2009" },
  "1223": { name: "MUHAMMED FAHEEM", dob: "24-10-2008" },
  "1255": { name: "FINAN", dob: "27-01-2009" },
  "1257": { name: "FAIZAN", dob: "24-10-2008" },
  "983": { name: "MAUROOF K", dob: "31-12-2007" },
  "957": { name: "MUHAMMED MASHHOOD. P", dob: "06-01-2009" },
  "972": { name: "MUHAMMED SWABEEH V P", dob: "21-10-2008" },
  "996": { name: "ABDUL RAHMAN", dob: "17-05-2008" },
  "973": { name: "MOHAMMED SHAHEEM PK", dob: "21-07-2008" },
  "989": { name: "MOHAMMED JASIR AV", dob: "28-12-2008" },
  "979": { name: "MUSTHAFA NAZIM K", dob: "22-04-2008" },
  "974": { name: "MOHAMMED HARSHAD", dob: "16-01-2008" },
  "963": { name: "MUHAMMAD DHANISH", dob: "11-06-2008" },
  "965": { name: "MUHAMMAD SABITH", dob: "16-04-2009" },
  "991": { name: "MOHAMMEDUL KHAIR AP", dob: "25-04-2008" },
  "971": { name: "MUHAMMED SINAN PA", dob: "19-06-2008" },
  "1091": { name: "MUHAMMED HISHAM", dob: "21-04-2009" },
  "966": { name: "AHAMMED RAMI P", dob: "02-04-2008" },
  "984": { name: "MOHAMMED SUHAIL P", dob: "29-01-2008" },
  "994": { name: "MUHAMMED SABITH M", dob: "09-03-2008" },
  "959": { name: "MUHAMMED IJLAN", dob: "28-06-2008" },
  "986": { name: "MOHAMMED ANSHID P", dob: "14-04-2008" },
  "960": { name: "MUHAMMED MUSTHAFA", dob: "02-12-2008" },
  "961": { name: "SAYYED HAMID SABEEL", dob: "26-05-2008" },
  "982": { name: "MUHAMMED JUNAID", dob: "27-05-2008" },
  "949": { name: "MUHAMMED SIRAS", dob: "11-11-2006" },
  "992": { name: "MOHAMMED MUNEEF P P", dob: "11-10-2008" },
  "987": { name: "LABEEB K M", dob: "27-04-2009" },
  "988": { name: "MOHAMMED MUSSAMMIL. K. C", dob: "04-07-2007" },
  "995": { name: "MUHAMMED ADHIL FARAH", dob: "15-09-2008" },
  "926": { name: "FASEEH AHMED", dob: "05-06-2007" },
  "969": { name: "MUHAMMED IBRAHEEM V", dob: "14-03-2008" },
  "968": { name: "MUHAMMED AFLAH T P", dob: "12-05-2009" },
  "978": { name: "ABDUL BASITH A", dob: "19-12-2007" },
  "954": { name: "FUHAD AHAMMED", dob: "05-11-2007" },
  "939": { name: "MUHAMMED SHABEEB PM", dob: "18-12-2006" },
  "932": { name: "MOHAMMED RISHAB KM", dob: "28-12-2006" },
  "931": { name: "MUHAMMAD ALI RINSHID AV", dob: "16-10-2007" },
  "1214": { name: "JASIR ALI VP", dob: "26-05-2007" },
  "922": { name: "MUHAMMED ANSHID M", dob: "27-01-2008" },
  "934": { name: "FOUZ IBRAHIM UP", dob: "05-10-2007" },
  "1220": { name: "AHMED FAYAS CA", dob: "24-09-2007" },
  "917": { name: "MOHAMED FAYIZ PK", dob: "09-06-2007" },
  "940": { name: "SAYYID THAFHEEM VT", dob: "01-02-2007" },
  "933": { name: "MUJTHABA MINHAJ", dob: "28-11-2006" },
  "929": { name: "MOHAMED THANSEEH PK", dob: "06-01-2007" },
  "942": { name: "FARIS P", dob: "08-06-2007" },
  "918": { name: "IBRAHEEM BAHADOORSHA", dob: "13-02-2008" },
  "946": { name: "MUHAMMED ZIYAD K", dob: "17-10-2007" },
  "896": { name: "MUHAMMED SHADIL", dob: "24-02-2007" },
  "915": { name: "MUHAMMAD JINSHAD VP", dob: "01-05-2008" },
  "951": { name: "MUHAMMED MINHAJ PP", dob: "02-08-2007" },
  "935": { name: "SALMAN FARIS TP", dob: "05-08-2006" },
  "943": { name: "MOHAMED SHAMVEEL", dob: "30-03-2008" },
  "914": { name: "MUHAMMED ARSHAD MK", dob: "22-05-2008" },
  "923": { name: "MOHAMMED SINAN NK", dob: "14-08-2007" },
  "911": { name: "MUHAMMED ANSARI KC", dob: "16-07-2006" },
  "1221": { name: "SHIFIN MUHAMMED C", dob: "15-08-2007" },
  "916": { name: "MUHAMED SALIH M", dob: "27-07-2007" },
  "1216": { name: "MOHAMMED SINAN T", dob: "16-05-2007" },
  "912": { name: "MUHAMMED MUNAVIR MP", dob: "01-10-2006" },
  "952": { name: "MUHAMMED SALIM MK", dob: "26-12-2006" },
  "1215": { name: "MUHAMMED SWALIH", dob: "23-10-2007" },
  "1217": { name: "MUHAMMED BADUSHA VC", dob: "24-03-2008" },
  "927": { name: "MUHAMMED SHAN K", dob: "20-07-2006" },
  "1213": { name: "MUHAMMED NADIM KK", dob: "23-05-2007" },
  "1218": { name: "MUHAMMED JABIR", dob: "03-10-2007" },
  "953": { name: "MOHAMED RIFATH", dob: "23-06-2007" },
  "938": { name: "RAIHAN TN", dob: "28-07-2007" },
  "1219": { name: "MUHAMMED AFNAN PK", dob: "13-01-2007" },
  "921": { name: "AMAL SHAJAS KT", dob: "11-08-2007" },
  "937": { name: "MUHAMMED AFSAL", dob: "27-08-2007" },
  "919": { name: "MUHAMMED MAZIN RK", dob: "14-11-2006" },
  "936": { name: "RADHIN MOHAMMED P", dob: "27-01-2008" },
  "873": { name: "HAZEEB", dob: "10-09-2005" },
  "1174": { name: "MUDDASSIR SIDDIQUE M K", dob: null },
  "868": { name: "MUHAMMED LABEEB", dob: "14-11-2005" },
  "876": { name: "MUHAMMED HAFEEF", dob: "23-02-2007" },
  "875": { name: "AHAMMED SADEED", dob: "25-10-2006" },
  "881": { name: "MUHAMMED SWALIH", dob: "20-12-2006" },
  "1175": { name: "MUHAMMED SWABEEH AK", dob: null },
  "884": { name: "MUHAMMED ASEEL", dob: "06-10-2006" },
  "904": { name: "SANAD M", dob: "19-07-2005" },
  "956": { name: "ALI AFNAN P", dob: "13-07-2006" },
  "905": { name: "SAHAL", dob: "23-08-2006" },
  "890": { name: "MUHAMMED ALTHAF", dob: "26-12-2005" },
  "902": { name: "MUHAMMED ASHIQ MON", dob: "27-07-2005" },
  "899": { name: "ABDULLA LABEEB", dob: "07-12-2005" },
  "889": { name: "MUHAMMED ADNAN KC", dob: "16-12-2006" },
  "872": { name: "AHAMMED", dob: "25-05-2007" },
  "863": { name: "MUHAMMED BAHJATH HUSSAIN", dob: "18-09-2005" },
  "877": { name: "MUHAMMED ADNAN A", dob: "09-12-2006" },
  "901": { name: "MUHAMMED SAHAD", dob: "19-09-2006" },
  "888": { name: "MUHAMMED SHIBLI", dob: "24-05-2007" },
  "1173": { name: "ASHMIL ASHRAF K", dob: null },
  "886": { name: "SAYYID SALOOM", dob: "25-09-2006" },
  "874": { name: "HIDHAN MUHAMMED", dob: "29-10-2005" },
  "880": { name: "MUHAMMED BUJAIR CK", dob: "26-04-2007" },
  "885": { name: "MUHAMMED ASHMAL", dob: "30-12-2005" },
  "871": { name: "SHIMAS AHMED", dob: "11-03-2006" },
  "882": { name: "MUHAMMED ANSHID", dob: "12-05-2007" },
  "869": { name: "MUHAMMED SHIFAN", dob: "21-10-2005" },
  "887": { name: "MUHAMMED RASHAD", dob: "23-12-2005" },
  "870": { name: "MUHAMMED SHIBLI M", dob: "12-06-2006" },
  "879": { name: "MUHAMMED JUNAID", dob: "08-07-2005" },
  "1000": { name: "RABEEB CT", dob: "26-07-2006" },
  "866": { name: "AHAMMED HASHIR TK", dob: "04-03-2006" },
  "900": { name: "MUHAMMED FAYIS", dob: "02-01-2007" },
  "892": { name: "BUJAIR SABIN", dob: "26-11-2005" },
  "891": { name: "UMARUL FAROOK", dob: "13-09-2005" },
  "1254": { name: "MOHAMED ROSHEN", dob: null }
};
        // --- 3. STATE ---
        let currentVoter = null;
        let currentStepIndex = 0;

        // --- 4. AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'click') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'success') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                osc.frequency.setValueAtTime(600, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            }
        }

        // --- 5. UI HELPERS ---
        function showToast(msg, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderLeft = type === 'error' ? '5px solid #f44336' : '5px solid #4caf50';
            toast.textContent = msg;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function switchPage(pageId) {
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
        }

        // --- 6. APP LOGIC ---
        const app = {
            goToLogin: () => switchPage('login-page'),
            goToAdminAuth: () => switchPage('admin-auth-page'),
            goToIntro: () => switchPage('intro-page'),

            // Load Home Page Stats
            loadHomeStats: () => {
                const totalStudents = Object.keys(VOTERS).length;
                document.getElementById('home-total').textContent = totalStudents;

                // Listen for vote updates to update home stats
                db.ref('voters').on('value', (snapshot) => {
                    const votedData = snapshot.val() || {};
                    const votedCount = Object.keys(votedData).length;
                    const waitingCount = totalStudents - votedCount;

                    document.getElementById('home-voted').textContent = votedCount;
                    document.getElementById('home-waiting').textContent = waitingCount;
                });
            },

            verifyVoter: async () => {
                const inputId = document.getElementById('voterId').value.trim();
                const inputPass = document.getElementById('voterPass').value.trim().toUpperCase();
                const spinner = document.getElementById('login-spinner');

                if (!inputId || !inputPass) {
                    showToast("Please enter Voter ID and Password", 'error');
                    return;
                }

                spinner.classList.remove('hidden');

                try {
                    // 1Ô∏è‚É£ Check voter exists
                    const voterData = VOTERS[inputId];

                    if (!voterData) {
                        showToast("Invalid Voter ID", 'error');
                        spinner.classList.add('hidden');
                        return;
                    }

                    // 1bÔ∏è‚É£ Verify Password (First 4 letters of name + DOB DDMMYYYY)
                    const nameClean = voterData.name.replace(/[^a-zA-Z]/g, ''); 
                    const namePart = nameClean.substring(0, 4);
                    
                    if (!voterData.dob) {
                        showToast("Date of Birth missing for this ID. Contact Admin.", 'error');
                        spinner.classList.add('hidden');
                        return;
                    }
                    const dobPart = voterData.dob.replace(/-/g, '');
                    
                    const targetPassword = namePart + dobPart;

                    if (inputPass !== targetPassword) {
                        console.log(`Expected: ${targetPassword}, Got: ${inputPass}`);
                        showToast("Incorrect Password", 'error');
                        spinner.classList.add('hidden');
                        return;
                    }

                    // 2Ô∏è‚É£ Check already voted (Firebase)
                    const snapshot = await db.ref(`voters/${inputId}`).once('value');

                    if (snapshot.exists()) {
                        showToast("This voter has already voted", 'error');
                        spinner.classList.add('hidden');
                        return;
                    }

                    // 3Ô∏è‚É£ Login success
                    currentVoter = { id: inputId, name: voterData.name };
                    document.getElementById('display-voter-name').textContent = voterData.name;
                    document.getElementById('display-voter-id').textContent = inputId;

                    spinner.classList.add('hidden');
                    app.startVotingProcess();

                } catch (err) {
                    console.error(err);
                    showToast("Unexpected error occurred", 'error');
                    spinner.classList.add('hidden');
                }
            },

            verifyAdmin: () => {
                const u = document.getElementById('adminUser').value.trim();
                const p = document.getElementById('adminPass').value.trim();

                if(u === 'naseefugr' && p === 'ugr1022') {
                    app.loadAdminData();
                    switchPage('admin-page');
                } else {
                    showToast("Invalid Username or Password", 'error');
                }
            },

            startVotingProcess: () => {
                currentStepIndex = 0;
                switchPage('inking-page');
                playTone('click');

                const brush = document.getElementById('brush-anim');
                const ink = document.getElementById('ink-path');
                
                // Reset animations
                brush.classList.remove('animate-brush-in', 'animate-brush-out');
                ink.classList.remove('animate-ink-stroke');
                void brush.offsetWidth; // Trigger reflow

                // Start sequence
                brush.classList.add('animate-brush-in');
                ink.classList.add('animate-ink-stroke');
                brush.classList.add('animate-brush-out');

                setTimeout(() => {
                    app.renderVotingScreen();
                    switchPage('voting-page');
                }, 3000); // Wait for animations
            },

            renderVotingScreen: () => {
                const position = POSITIONS[currentStepIndex];
                const list = NOMINEES[position];
                
                document.getElementById('position-title').textContent = position.charAt(0).toUpperCase() + position.slice(1);
                const container = document.getElementById('nominees-container');
                container.innerHTML = '';

                // Render Regular Nominees
                list.forEach(nominee => {
                    const card = document.createElement('div');
                    card.className = 'nominee-card';
                    card.onclick = () => app.castVote(position, nominee.id, nominee.name);
                    
                    card.innerHTML = `
                        <img src="${nominee.photo}" class="nominee-img" alt="${nominee.name}">
                        <div class="nominee-info">
                            <div class="nominee-name">${nominee.name}</div>
                            <div class="nominee-role">${position}</div>
                        </div>
                        <div class="vote-btn-overlay">VOTE</div>
                    `;
                    container.appendChild(card);
                });

                // Add NOTA Option
                const notaCard = document.createElement('div');
                notaCard.className = 'nominee-card nota-card';
                notaCard.onclick = () => app.castVote(position, 'NOTA', 'NOTA');
                notaCard.innerHTML = `
                    <div class="nota-icon">üö´</div>
                    <div class="nominee-info">
                        <div class="nominee-name">NOTA</div>
                        <div class="nominee-role">None Of The Above</div>
                    </div>
                    <div class="vote-btn-overlay">VOTE</div>
                `;
                container.appendChild(notaCard);
            },

            castVote: async (position, nomineeId, nomineeName) => {
                if(!confirm(`Confirm vote for ${nomineeName} as ${position}?`)) return;
                playTone('click');

                try {
                    const voteRef = db.ref(`votes/${position}/${nomineeId}`);
                    const snapshot = await voteRef.once('value');
                    const currentCount = snapshot.val() || 0;
                    await voteRef.set(currentCount + 1);
                } catch (e) {
                    showToast("Failed to save vote", 'error');
                    return;
                }

                if (currentStepIndex === POSITIONS.length - 1) {
                    await db.ref(`voters/${currentVoter.id}`).set(true);
                    app.finishVoting();
                } else {
                    currentStepIndex++;
                    app.renderVotingScreen();
                }
            },

            finishVoting: () => {
                switchPage('success-page');
                playTone('success');
                
                // Trigger box lid animation
                const box = document.getElementById('ballot-box-anim');
                const paper = document.querySelector('.paper');
                
                setTimeout(() => {
                    box.classList.add('lid-open');
                    paper.style.animation = 'foldAndDrop 3s forwards ease-in-out';
                }, 500);
                
                setTimeout(() => {
                    currentVoter = null;
                    document.getElementById('voterId').value = '';
                    document.getElementById('voterPass').value = '';
                    // Reset lid for next time
                    box.classList.remove('lid-open');
                    paper.style.animation = 'none';
                    switchPage('intro-page');
                }, 5000);
            },

            loadAdminData: () => {
                const totalStudents = Object.keys(VOTERS).length;
                document.getElementById('stat-total').textContent = totalStudents;

                // Votes Stats
                const votesContainer = document.getElementById('admin-stats');
                votesContainer.innerHTML = '<div class="spinner"></div>';

                db.ref('votes').on('value', (snapshot) => {
                    const data = snapshot.val() || {};
                    votesContainer.innerHTML = '';

                    POSITIONS.forEach(pos => {
                        const nominees = NOMINEES[pos];
                        const posData = data[pos] || {};
                        let total = 0;
                        
                        Object.values(posData).forEach(val => total += val);

                        let html = `<div class="nom-stat-card"><h3>${pos.toUpperCase()}</h3>`;
                        
                        nominees.forEach(nom => {
                            const count = posData[nom.id] || 0;
                            const pct = total > 0 ? (count / total) * 100 : 0;
                            html += `
                                <div class="stat-row">
                                    <span>${nom.name}</span>
                                    <strong>${count}</strong>
                                </div>
                                <div class="stat-bar-bg">
                                    <div class="stat-bar-fill" style="width: ${pct}%"></div>
                                </div>
                                <div style="height: 15px;"></div>
                            `;
                        });

                        // NOTA Stats
                        const notaCount = posData['NOTA'] || 0;
                        const notaPct = total > 0 ? (notaCount / total) * 100 : 0;
                        html += `
                                <div class="stat-row" style="color:#c62828; font-weight:bold;">
                                    <span>NOTA</span>
                                    <strong>${notaCount}</strong>
                                </div>
                                <div class="stat-bar-bg">
                                    <div class="stat-bar-fill" style="width: ${notaPct}%; background-color:#c62828;"></div>
                                </div>
                        `;

                        html += `</div>`;
                        votesContainer.innerHTML += html;
                    });
                });

                // Voter List Stats (SEPARATE LOGIC)
                db.ref('voters').on('value', (snapshot) => {
                    const votedData = snapshot.val() || {};
                    const votedIds = Object.keys(votedData);
                    const votedCount = votedIds.length;
                    const waitingCount = totalStudents - votedCount;

                    document.getElementById('stat-voted').textContent = votedCount;
                    document.getElementById('stat-waiting').textContent = waitingCount;
                    
                    // Badges count
                    document.getElementById('count-voted-badge').textContent = votedCount;
                    document.getElementById('count-pending-badge').textContent = waitingCount;

                    // Get Containers
                    const votedListContainer = document.getElementById('voted-list');
                    const pendingListContainer = document.getElementById('pending-list');
                    
                    // Clear Lists
                    votedListContainer.innerHTML = '';
                    pendingListContainer.innerHTML = '';

                    const allIds = Object.keys(VOTERS).sort();
                    
                    allIds.forEach(id => {
                        const name = VOTERS[id].name;
                        const hasVoted = votedIds.includes(id);
                        
                        const row = document.createElement('div');
                        row.className = 'voter-row';
                        
                        const rowHtml = `
                            <span>${name}</span> 
                            <div>
                                <span style="font-family:monospace; color:#666; margin-right:10px;">${id}</span>
                                ${hasVoted ? '<span class="status-badge status-voted">Voted</span>' : '<span class="status-badge status-pending">Pending</span>'}
                            </div>
                        `;

                        row.innerHTML = rowHtml;

                        // Append to correct list
                        if (hasVoted) {
                            votedListContainer.appendChild(row);
                        } else {
                            pendingListContainer.appendChild(row);
                        }
                    });
                });
            },

            resetElection: async () => {
                if(!confirm("ARE YOU SURE? This deletes all votes.")) return;
                
                try {
                    await db.ref('votes').set(null);
                    await db.ref('voters').set(null);
                    showToast("Election Reset Successfully", 'success');
                    app.loadAdminData();
                } catch(e) {
                    showToast("Error resetting", 'error');
                }
            }
        };

        // Initialize Home Stats immediately
        app.loadHomeStats();
        
        window.app = app;
    </script>
</body>
</html>